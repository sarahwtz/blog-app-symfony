{% extends '@EasyAdmin/page/content.html.twig' %}

{% block content %}
<div style="
    font-family: sans-serif;
    padding: 20px;
    min-height: 80vh;
    background-image: url('/uploads/backgrounds/cabbage_2.png');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    position: relative;
">

    {# Overlay transparente 30% #}
    <div style="
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        background-color: rgba(255,255,255,0.3);
        z-index: 0;
    "></div>

    {# Conteúdo #}
    <div style="position: relative; z-index: 1;">

        {# --- Faixa título e estatísticas --- #}
        <div style="
            background: rgba(255,255,255,0.9);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        ">
            <h1 style="margin-bottom: 20px; color: #000000; font-weight: bold;">Welcome to the Cabbage News!</h1>

            <div style="display: flex; flex-wrap: wrap; gap: 20px;">
                <div style="
                    flex:1; min-width: 150px;
                    background-color: rgba(76,175,80,0.7);
                    color:#006400; padding:20px;
                    border-radius:10px; text-align:center;
                    transition: transform 0.2s;
                " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    <h2 style="font-weight: bold; color: #000000;">{{ posts_count }}</h2>
                    <p style="font-weight: bold;">Posts</p>
                </div>
                <div style="
                    flex:1; min-width: 150px;
                    background-color: rgba(33,150,243,0.7);
                    color:#006400; padding:20px;
                    border-radius:10px; text-align:center;
                    transition: transform 0.2s;
                " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    <h2 style="font-weight: bold; color: #000000;">{{ comments_count }}</h2>
                    <p style="font-weight: bold;">Comments</p>
                </div>
            </div>
        </div>

        {# --- Faixa dos gráficos --- #}
        <div style="
            background: rgba(255,255,255,0.9);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        ">
            <div style="display: flex; flex-wrap: wrap; gap: 40px;">
                <div style="flex:1; min-width: 250px;">
                    <h3 style="color: #000000; font-weight: bold;">Posts per month</h3>
                    <canvas id="postsChart" style="width:100%; height:300px;"></canvas>
                </div>
                <div style="flex:1; min-width: 250px;">
                    <h3 style="color: #000000; font-weight: bold;">Comments per post</h3>
                    <canvas id="commentsChart" style="width:100%; height:300px;"></canvas>
                </div>
            </div>
        </div>

        {# --- Últimos posts --- #}
        <div>
            <h3 style="margin-bottom: 10px; color: #000000; font-weight: bold;">Last Posts</h3>
            <ul style="list-style: none; padding-left: 0;">
                {% for post in latest_posts %}
                    <li style="
                        background: rgba(255,255,255,0.8);
                        padding: 10px 15px;
                        margin-bottom: 8px;
                        border-radius: 5px;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        transition: transform 0.2s;
                    " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                        <strong style="color: #006400; font-weight: bold;">
                            {{ post.title|length > 30 ? post.title|slice(0,30) ~ '...' : post.title }}
                        </strong>
                        <small style="color: #006400; font-weight: bold;">{{ post.createdAt|date('F Y') }}</small>
                    </li>
                {% else %}
                    <li style="background: rgba(255,255,255,0.8); padding: 10px 15px; border-radius: 5px;">No posts yet</li>
                {% endfor %}
            </ul>
        </div>

        {# --- Scripts Chart.js --- #}
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            const postsData = {
                labels: {{ posts_by_month|keys|json_encode|raw }},
                datasets: [{
                    label: 'Posts per month',
                    data: {{ posts_by_month|json_encode|raw }},
                    backgroundColor: '#800080',
                    borderColor: '#800080',
                    borderWidth: 1
                }]
            };

            const commentsData = {
                labels: {{ comments_by_post|keys|json_encode|raw }},
                datasets: [{
                    label: 'Comments per post',
                    data: {{ comments_by_post|json_encode|raw }},
                    backgroundColor: '#800080',
                    borderColor: '#800080',
                    borderWidth: 1
                }]
            };

            new Chart(document.getElementById('postsChart'), {
                type: 'bar',
                data: postsData,
                options: {
                    responsive:true,
                    plugins: { legend:{ display:false } },
                    scales: {
                        x: { ticks:{ color:'#000' }, grid:{ color:'#00000022' } },
                        y: { beginAtZero:true, ticks:{ color:'#000' }, grid:{ color:'#00000022' } }
                    }
                }
            });

            new Chart(document.getElementById('commentsChart'), {
                type: 'bar',
                data: commentsData,
                options: {
                    responsive:true,
                    plugins: { legend:{ display:false } },
                    scales: {
                        x: { ticks:{ color:'#000' }, grid:{ color:'#00000022' } },
                        y: { beginAtZero:true, ticks:{ color:'#000' }, grid:{ color:'#00000022' } }
                    }
                }
            });
        </script>

    </div> {# fim conteúdo z-index 1 #}
</div>
{% endblock %}
